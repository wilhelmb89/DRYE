{%- comment -%} === Globala routes (behövs) === {%- endcomment -%}
<script>
  {% liquid
    if routes.root_url == '/'
      assign base = ''
    else
      assign base = routes.root_url
    endif
  %}
  window.shopUrl = '{{ base }}';
  window.routes = {
    cart_add_url: '{{ routes.cart_add_url }}',
    cart_change_url: '{{ routes.cart_change_url }}',
    cart_update_url: '{{ routes.cart_update_url }}',
    cart_url: '{{ routes.cart_url }}',
    predictive_search_url: '{{ routes.predictive_search_url }}',
  };
</script>

{%- comment -%} === Core bundles (defer) === {%- endcomment -%}
<script src="{{ 'vendor.js' | asset_url }}" defer></script>
<script src="{{ 'main.bundle.js' | asset_url }}" defer></script>
{%- if assets['theme.min.js'] -%}
  <script src="{{ 'theme.min.js' | asset_url }}" defer></script>
{%- else -%}
  <script src="{{ 'theme.js' | asset_url }}" defer></script>
{%- endif -%}

{%- comment -%} === Hjälpfunktioner för senladdning === {%- endcomment -%}
<script>
  window.loadScript = function (src) {
    var s = document.createElement('script'); s.src = src; s.defer = true; document.body.appendChild(s);
  };
  window.onIdle = function (cb) {
    if ('requestIdleCallback' in window) requestIdleCallback(cb, {timeout: 3000});
    else setTimeout(cb, 3000);
  };
</script>

{%- comment -%} === Swiper: ladda ENDAST om den faktiskt finns i DOM === {%- endcomment -%}
<script>
  (function () {
    var hasSwiper = document.querySelector('.swiper, .swiper-container');
    if (!hasSwiper) return;
    // OBS: Ladda INTE detta om Swiper redan är inbakat i dina bundles.
    loadScript('https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js');
  })();
</script>

{%- comment -%} === Sharer: bara på sidor där delningsknappar finns (produkt/artikel) och gärna efter idle === {%- endcomment -%}
{%- if request.page_type == 'product' or request.page_type == 'article' -%}
<script>
  onIdle(function () {
    loadScript('https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js');
  });
</script>
{%- endif -%}
