<cart-drawer class="drawer" data-toggle-attribute="data-toggle-cart">
  <div class="h-full grid grid-rows-[auto_1fr_auto]">
    <div class="border-solid border-b border-gray-200">
      {%- comment -%} Header {%- endcomment -%}
      <div class="flex justify-between items-center px-6 py-6 border-b border-gray-300">
        <h2 class="text-lg font-normal">{{ 'cart.title' | t }} ({{ cart.item_count }})</h2>
        <button
          class="w-6 h-6 flex items-center justify-center cursor-pointer text-black hover:bg-gray-100 rounded transition-colors"
          data-toggle-cart
          aria-label="{{ 'cart.close' | t }}"
        >
          {%- render 'icon', type: 'close', class: 'w-6 h-6' -%}
        </button>
      </div>

      {%- comment -%} Free Shipping Progress Bar {%- endcomment -%}
      {%- if section.settings.show_free_shipping_bar and section.settings.free_shipping_threshold > 0 -%}
        {%- liquid
          assign cart_total_price = cart.total_price | divided_by: 100.0
          assign free_shipping_threshold = section.settings.free_shipping_threshold
          assign amount_away = free_shipping_threshold | minus: cart_total_price
          assign progress_percentage = cart_total_price | divided_by: free_shipping_threshold | times: 100

          if progress_percentage > 100
            assign progress_percentage = 100
          endif

          if amount_away < 0
            assign amount_away = 0
          endif

          assign amount_away_string = amount_away | times: 100 | money_without_trailing_zeros
        -%}

        <div class="px-6 pb-6 ">
          {%- if amount_away > 0 -%}
            <p class="text-sm mb-3">{{ 'cart.free_shipping_away' | t: amount: amount_away_string }}</p>
            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
              <div
                class="bg-black h-full rounded-full transition-all duration-300"
                style="width: {{ progress_percentage }}%"
              ></div>
            </div>
          {%- else -%}
            <p class="text-sm mb-3">You qualify for free shipping!</p>
            <div class="w-full bg-black rounded-full h-2"></div>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>

    {%- comment -%} Cart Items {%- endcomment -%}
    <div class="overflow-y-auto">
      <form class="form" id="cart-drawer-form" action="{{ routes.cart_url }}" method="post">
        <div class="px-6">
          {%- for line_item in cart.items -%}
            {%- liquid
              assign index = line_item.index | plus: 1
            -%}
            <div class="py-6 flex gap-4 border-solid border-b border-gray-200" id="line-item-{{ index }}">
              {%- comment -%} Product Image {%- endcomment -%}
              <div class="w-24 h-24 media flex-shrink-0">
                {%- if line_item.image != blank -%}
                  {% render 'image',
                    image: line_item.image,
                    widths: '96, 192',
                    src_width: 96,
                    sizes: '96px',
                    class: 'img-fit'
                  %}
                {%- else -%}
                  {{ 'image' | placeholder_svg_tag: 'w-full h-full object-cover' }}
                {%- endif -%}
              </div>

              {%- comment -%} Product Details {%- endcomment -%}
              <div class="flex-1 min-w-0">
                <div class="flex justify-between items-start mb-2">
                  <div class="pr-2 flex-1">
                    <h3 class="text-sm font-normal leading-tight">{{ line_item.product.title }}</h3>
                    {%- if section.settings.show_variant
                      and line_item.product.has_only_default_variant == false
                    -%}
                      <div class="text-xs text-gray-600 mt-1">
                        {%- for option in line_item.options_with_values -%}
                          <span>{{ option.value }}</span>
                          {%- unless forloop.last -%}
                            <span class="mx-1">/</span>
                          {%- endunless -%}
                        {%- endfor -%}
                      </div>
                    {%- endif -%}
                  </div>
                  <a
                    class="js-remove-item p-1 -mt-1 -mr-1 hover:text-red-500 text-gray-500 transition-colors"
                    href="{{ line_item.url_to_remove }}"
                    data-index="{{ line_item.index | plus: 1 }}"
                    aria-label="{{- 'cart.remove_title' | t: title: line_item.title -}}"
                  >
                    {%- render 'icon', type: 'trash', class: 'w-5 h-5' -%}
                  </a>
                </div>

                {%- comment -%} Quantity and Price {%- endcomment -%}
                <div class="flex items-center justify-between mt-3">
                  {%- if section.settings.quantity_type == 'input' -%}
                    <quantity-input class="inline-block">
                      <label class="sr-only" for="{{ index | prepend: 'quantity-' }}">
                        {{- 'cart.headings.quantity' | t -}}
                      </label>
                      <div class="flex items-center border border-gray-300">
                        <button
                          type="button"
                          class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 transition-colors no-js-hidden"
                          name="minus"
                          aria-label="{{ 'cart.decrease_quantity' | t }}"
                        >
                          <span class="text-sm leading-none">âˆ’</span>
                        </button>
                        <input
                          type="number"
                          class="w-12 h-8 text-sm text-center border-0 focus:outline-none p-0 [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none"
                          id="{{ index | prepend: 'quantity-' }}"
                          name="updates[]"
                          min="0"
                          value="{{ line_item.quantity }}"
                          data-index="{{ index }}"
                          data-initial-value="{{ line_item.quantity }}"
                          aria-label="{{ 'cart.headings.quantity' | t }}"
                        >
                        <button
                          type="button"
                          class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 transition-colors no-js-hidden"
                          name="plus"
                          aria-label="{{ 'cart.increase_quantity' | t }}"
                        >
                          <span class="text-sm leading-none">+</span>
                        </button>
                      </div>
                    </quantity-input>
                  {%- elsif section.settings.quantity_type == 'text' -%}
                    <p class="text-sm text-gray-600">
                      {{ 'cart.line_item_count' | t: count: line_item.quantity }}
                    </p>
                  {%- endif -%}

                  <p class="text-base font-normal text-right">
                    {{ line_item.final_line_price | money }}
                  </p>
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>
      </form>
    </div>

    {%- comment -%} Footer with Subtotal and Checkout {%- endcomment -%}
    <div class="bg-gray-50 border-t border-gray-200 p-6 space-y-4">
      <div class="flex justify-between items-center">
        <span class="text-lg font-normal">{{ 'cart.subtotal' | t }}</span>
        <span class="text-lg font-normal">{{ cart.total_price | money }}</span>
      </div>

      <button
        type="submit"
        class="w-full bg-black text-white py-4 rounded hover:bg-gray-800 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
        name="checkout"
        form="cart-drawer-form"
        {% if cart == empty %}
          disabled
        {% endif %}
      >
        Check out
      </button>
    </div>
  </div>
</cart-drawer>

<div
  class="cart-backdrop fixed inset-0 bg-black bg-opacity-50 z-[2147483636] opacity-0 invisible transition-all duration-300"
  data-toggle-cart
></div>

{% schema %}
{
  "name": "Cart Drawer",
  "settings": [
    {
      "type": "header",
      "content": "Free Shipping"
    },
    {
      "type": "checkbox",
      "id": "show_free_shipping_bar",
      "label": "Show free shipping progress bar",
      "default": true
    },
    {
      "type": "number",
      "id": "free_shipping_threshold",
      "label": "Free shipping threshold",
      "info": "Amount in your store's currency required for free shipping",
      "default": 850
    },
    {
      "type": "header",
      "content": "Display Options"
    },
    {
      "type": "checkbox",
      "id": "show_variant",
      "label": "Show variant options",
      "default": true
    },
    {
      "type": "select",
      "id": "quantity_type",
      "label": "Quantity selector type",
      "options": [
        {
          "value": "text",
          "label": "Text only"
        },
        {
          "value": "input",
          "label": "Input with buttons"
        },
        {
          "value": "none",
          "label": "Hide"
        }
      ],
      "default": "input"
    }
  ]
}
{% endschema %}
